"0","#3. Rank state by number of voters who support guns?"
"0","gun_supporting_voters_state_ranking <- anes[names(anes) %in% c(""sample_state"",""gun_importance"")]"
"0","gun_supporting_voters_state_ranking <- na.omit(gun_supporting_voters_state_ranking)"
"0","counts_for_rank <- data.frame(gun_supporting_voters_state_ranking$sample_state, gun_supporting_voters_state_ranking$gun_importance)"
"0","count_aggregated <- aggregate(counts_for_rank$gun_supporting_voters_state_ranking.gun_importance,list(states = counts_for_rank$gun_supporting_voters_state_ranking.sample_state), length)"
"0","create_gradient_state_tile_map <- function(state, value, title, legend_title, low_color='#ccdbe5', high_color=""#114365"", state_grid='us_state_grid2') {"
"0","  "
"0","  df <- as.tibble(data.frame(state, value))"
"0","  "
"0","  fig <- df %>% "
"0","    mutate(x = 1) %>% # size of the bar being plotted. All bars should be same size to make perfect squares"
"0","    mutate(label_y = .5) %>%  # this location of state labels"
"0","    mutate(label_x = 1) %>% "
"0","    ggplot()+"
"0","    geom_bar(mapping=aes(x=x, fill=value))  +"
"0","    facet_geo(~ state, grid=state_grid) +"
"0","    scale_fill_continuous(low = low_color, high= high_color, guide = guide_colorbar(title = legend_title)) + # creates shading pattern"
"0","    ggtitle(title) +"
"0","    theme_classic() + # theme classic removes many ggplot defaults (grey background, etc)"
"0","    theme(plot.title = element_text(size = 28), # format the plot"
"0","          plot.margin = unit(c(1,1,1,1), ""cm""),"
"0","          legend.text=element_text(size=16),"
"0","          legend.title = element_text(size=16),"
"0","          axis.title=element_blank(),"
"0","          axis.text=element_blank(),"
"0","          axis.ticks = element_blank(),"
"0","          strip.text.x = element_blank(),"
"0","          axis.line = element_blank()) +"
"0","    geom_text(aes(x=label_x, y=label_y, label=state), color='#ffffff', size=4) "
"0","  "
"0","  return(fig)"
"0","}"
"0","# Using 2016 values, create a tile map"
"0","tile_map <- create_gradient_state_tile_map(count_aggregated$states,count_aggregated$x, title='State Gun Supporters', legend_title = ""Sample voter count"" )"
"0","tile_map"
